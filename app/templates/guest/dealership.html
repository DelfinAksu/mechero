{% extends "layout/base_guest.html" %}

{% block content %}
<div class="dealership-container">

  <!-- Sol kutu: Şehir ve bayi listesi -->
  <div class="dealership-list-box">
      <h2 class="form-title">Bayilerimiz</h2>

      <!-- Şehir Seçimi -->
      <form method="GET" action="{{ url_for('guest.list_dealerships') }}">
          <div class="form-field">
              <label for="city">Şehir Seç:</label>
              <select name="city_id" id="city" onchange="this.form.submit()">
                  <option value="">Tüm Şehirler</option>
                  {% for city in cities %}
                      <option value="{{ city.id }}" {% if city.id|string == selected_city_id %}selected{% endif %}>
                          {{ city.name }}
                      </option>
                  {% endfor %}
              </select>
          </div>
      </form>

      <!-- Bayi Listesi -->
      {% if dealerships %}
          <ul class="dealership-list">
              {% for d in dealerships %}
                  <li>
                      <strong>{{ d.name }}</strong><br>
                      {{ d.street }} No: {{ d.number }}<br>
                      Şehir: {{ d.city.name }}
                  </li>
              {% endfor %}
          </ul>
      {% else %}
          <p>Seçilen şehirde bayi bulunamadı.</p>
      {% endif %}
  </div>

  <!-- Sağ kutu: Harita -->
  <div class="dealership-map-box">
      <div id="map"></div>
  </div>

</div>

<!-- Leaflet CSS ve JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- JSON veriyi taşıyan gizli div -->
<div id="dealership-data" data-json='{{ dealerships_json | tojson | safe }}'></div>

<!-- Marker JS -->
<script>
  const jsonData = document.getElementById('dealership-data').getAttribute('data-json');
  const dealershipData = JSON.parse(jsonData);

  var map = L.map('map').setView([39.0, 35.0], 6);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
  }).addTo(map);

  dealershipData.forEach(d => {
      if (d.latitude && d.longitude) {
          L.marker([d.latitude, d.longitude])
              .addTo(map)
              .bindPopup(`<strong>${d.name}</strong><br>${d.street} No:${d.number}`);
      }
  });
</script>
<!--
<h2>Bayilerimiz</h2>


Şehir Seçimi 
<form method="GET" action="{{ url_for('guest.list_dealerships') }}">
  <label for="city">Şehir Seç:</label>
  <select name="city_id" id="city" onchange="this.form.submit()">
    <option value="">Tüm Şehirler</option>
    {% for city in cities %}
      <option value="{{ city.id }}" {% if city.id|string == selected_city_id %}selected{% endif %}>
        {{ city.name }}
      </option>
    {% endfor %}
  </select>
</form>

Bayi Listesi
{% if dealerships %}
  <ul>
    {% for d in dealerships %}
      <li>
        <strong>{{ d.name }}</strong><br>
        {{ d.street }} No: {{ d.number }}<br>
        Şehir: {{ d.city.name }}
      </li>
    {% endfor %}
  </ul>

  Harita Kutusu 
  <div id="map" style="height: 500px; margin-top: 20px;"></div>

  Leaflet CSS ve JS 
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  JSON veriyi taşıyan gizli div
  <div id="dealership-data" data-json='{{ dealerships_json | tojson | safe }}'></div>

  Markerları Göster 
  <script>
    const jsonData = document.getElementById('dealership-data').getAttribute('data-json');
    const dealershipData = JSON.parse(jsonData); 
    var map = L.map('map').setView([39.0, 35.0], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
    }).addTo(map);

    dealershipData.forEach(d => {
      if (d.latitude && d.longitude) {
        L.marker([d.latitude, d.longitude])
          .addTo(map)
          .bindPopup(`<strong>${d.name}</strong><br>${d.street} No:${d.number}`);
      }
    });
  </script>  

{% else %}
  <p>Seçilen şehirde bayi bulunamadı.</p>
{% endif %} -->

{% endblock %}

